jQuery(function(a){function b(a){var b=this;this.$el=a,this.$content=a.find(".bto_group_data"),this.$metabox_title=a.find("h3 .group_name"),this.$section_links=this.$content.find(".subsubsub a"),this.$sections=this.$content.find(".tab_group"),this.$discount=this.$content.find(".group_discount"),this.$filters=this.$content.find(".group_filters"),this.$query_type_containers=this.$content.find(".bto_query_type_selector"),this.$query_type_selector=this.$content.find("select.bto_query_type"),this.$title_input=this.$content.find("input.group_title"),this.$priced_individually_input=this.$content.find(".group_priced_individually input"),this.$show_filters_input=this.$content.find(".group_show_filters input"),this.section_changed=function(a){b.$section_links.removeClass("current"),a.addClass("current"),b.$sections.addClass("tab_group_hidden"),b.$content.find(".tab_group_"+a.data("tab")).removeClass("tab_group_hidden")},this.title_changed=function(){b.$metabox_title.text(b.$title_input.val())},this.query_type_changed=function(){b.$query_type_containers.hide(),b.$content.find(".bto_query_type_"+b.$query_type_selector.val()).show()},this.priced_individually_input_changed=function(){b.$priced_individually_input.is(":checked")?b.$discount.show():b.$discount.hide()},this.show_filters_input_changed=function(){b.$show_filters_input.is(":checked")?b.$filters.show():b.$filters.hide()},this.initialize=function(){b.query_type_changed(),b.priced_individually_input_changed(),b.show_filters_input_changed()},this.initialize()}function c(){t.length>0?q.removeClass("disabled"):q.addClass("disabled")}function d(){r.on("click",".subsubsub a",function(b){var c=a(this),d=a(this).closest(".bto_group"),e=d.data("component_metabox_id"),f=v[e];f.section_changed(c),b.preventDefault()}).on("click","a.remove_row",function(b){var c=a(this).closest(".bto_group"),d=c.data("component_metabox_id");c.find("*").off(),c.remove(),delete v[d],p.triggerHandler("wc-cp-components-changed"),b.preventDefault()}).on("keyup","input.group_title",function(){var b=a(this).closest(".bto_group"),c=b.data("component_metabox_id"),d=v[c];d.title_changed()}).on("change","select.bto_query_type",function(){var b=a(this).closest(".bto_group"),c=b.data("component_metabox_id"),d=v[c];d.query_type_changed()}).on("change",".group_priced_individually input",function(){var b=a(this).closest(".bto_group"),c=b.data("component_metabox_id"),d=v[c];d.priced_individually_input_changed()}).on("change",".group_show_filters input",function(){var b=a(this).closest(".bto_group"),c=b.data("component_metabox_id"),d=v[c];d.show_filters_input_changed()}).on("click",".upload_component_image_button",function(b){C.$button=a(this),b.preventDefault(),C.image_frame?C.image_frame.open():(C.image_frame=wp.media({title:wc_composite_admin_params.i18n_choose_component_image,button:{text:wc_composite_admin_params.i18n_set_component_image},states:[new wp.media.controller.Library({title:wc_composite_admin_params.i18n_choose_component_image,filterable:"all"})]}),C.image_frame.on("select",function(){var a=C.image_frame.state().get("selection").first().toJSON(),b=a.sizes&&a.sizes.thumbnail?a.sizes.thumbnail.url:a.url;C.$button.addClass("has_image"),C.$button.closest(".component_image").find(".remove_component_image_button").addClass("has_image"),C.$button.find("input").val(a.id).change(),C.$button.find("img").eq(0).attr("src",b)}),C.image_frame.open())}).on("click",".remove_component_image_button",function(b){var c=a(this),d=c.closest(".component_image"),e=d.find(".upload_component_image_button");b.preventDefault(),e.removeClass("has_image"),c.removeClass("has_image"),d.find("input").val("").change(),e.find("img").eq(0).attr("src",wc_composite_admin_params.wc_placeholder_img_src)}),p.on("click","button.add_bto_group",function(){p.block(D),u++;var c={action:"woocommerce_add_composite_component",post_id:woocommerce_admin_meta_boxes.post_id,id:u,security:wc_composite_admin_params.add_component_nonce};return setTimeout(function(){a.post(woocommerce_admin_meta_boxes.ajax_url,c,function(c){s.append(c);var d=a(".bto_group",s).last(),e=new b(d),f="component_"+u;d.data("component_metabox_id",f),v[f]=e,p.triggerHandler("wc-cp-components-changed"),d.wc_cp_select2(),d.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),p.triggerHandler("wc-cp-component-added",[e]),p.unblock()})},250),!1})}function e(){s.sortable({items:".bto_group",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,b){b.item.removeAttr("style"),p.triggerHandler("wc-cp-components-changed")}}),c()}function f(){v={},t.each(function(c){var d=a(this),e="component_"+c;d.data("component_metabox_id",e),v[e]=new b(d)}),e()}function g(){d(),f(),e(),r.wc_cp_select2_component_options()}function h(a){var b=this;this.$el=a,this.$content=a.find(".bto_scenario_data"),this.$metabox_title=a.find("h3 .scenario_name"),this.$title_input=this.$content.find("input.scenario_title"),this.$conditional_components_action_input=this.$content.find(".toggle_conditional_components input"),this.$conditional_components_action_config=this.$content.find(".scenario_action_conditional_components_group .action_components"),this.title_changed=function(){b.$metabox_title.text(b.$title_input.val())},this.component_modifier_changed=function(a){"masked"===a.val()?a.closest(".bto_scenario_selector").find(".bto_scenario_selector_inner").slideUp(200):a.closest(".bto_scenario_selector").find(".bto_scenario_selector_inner").slideDown(200)},this.conditional_components_action_input_changed=function(){b.$conditional_components_action_input.is(":checked")?b.$conditional_components_action_config.slideDown(200):b.$conditional_components_action_config.slideUp(200)},this.initialize=function(){},this.initialize()}function i(){z.length>0?x.removeClass("disabled"):x.addClass("disabled")}function j(){w.on("click","a.remove_row",function(b){var c=a(this).closest(".bto_scenario"),d=c.data("scenario_metabox_id");c.find("*").off(),c.remove(),delete B[d],w.triggerHandler("wc-cp-scenarios-changed"),b.preventDefault()}).on("keyup","input.scenario_title",function(){var b=a(this).closest(".bto_scenario"),c=b.data("scenario_metabox_id"),d=B[c];d.title_changed()}).on("change","select.bto_scenario_exclude",function(){var b=a(this).closest(".bto_scenario"),c=b.data("scenario_metabox_id"),d=B[c];d.component_modifier_changed(a(this))}).on("change",".toggle_conditional_components input",function(){var b=a(this).closest(".bto_scenario"),c=b.data("scenario_metabox_id"),d=B[c];d.conditional_components_action_input_changed()}).on("click","button.add_bto_scenario",function(){w.block(D),A++;var b={action:"woocommerce_add_composite_scenario",post_id:woocommerce_admin_meta_boxes.post_id,id:A,security:wc_composite_admin_params.add_scenario_nonce};return setTimeout(function(){a.post(woocommerce_admin_meta_boxes.ajax_url,b,function(b){y.append(b);var c=a(".bto_scenario",y).last(),d=new h(c),e="scenario_"+A;c.data("scenario_metabox_id",e),B[e]=d,w.triggerHandler("wc-cp-scenarios-changed"),c.wc_cp_select2(),c.wc_cp_select2_component_options(),c.find(".tips, .woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),w.triggerHandler("wc-cp-scenario-added",[d]),w.unblock()})},250),!1})}function k(){y.sortable({items:".bto_scenario",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,b){b.item.removeAttr("style"),w.triggerHandler("wc-cp-scenarios-changed")}}),i()}function l(){B={},z.each(function(b){var c=a(this),d="scenario_"+b;c.data("scenario_metabox_id",d),B[d]=new h(c)}),k()}function m(){j(),l(),k(),w.wc_cp_select2_component_options()}var n={language:{errorLoading:function(){return wc_composite_admin_params.i18n_ajax_error},inputTooLong:function(a){var b=a.input.length-a.maximum;return 1===b?wc_composite_admin_params.i18n_input_too_long_1:wc_composite_admin_params.i18n_input_too_long_n.replace("%qty%",b)},inputTooShort:function(a){var b=a.minimum-a.input.length;return 1===b?wc_composite_admin_params.i18n_input_too_short_1:wc_composite_admin_params.i18n_input_too_short_n.replace("%qty%",b)},loadingMore:function(){return wc_composite_admin_params.i18n_load_more},maximumSelected:function(a){return 1===a.maximum?wc_composite_admin_params.i18n_selection_too_long_1:wc_composite_admin_params.i18n_selection_too_long_n.replace("%qty%",a.maximum)},noResults:function(){return wc_composite_admin_params.i18n_no_matches},searching:function(){return wc_composite_admin_params.i18n_searching}}},o={formatMatches:function(a){return 1===a?wc_composite_admin_params.i18n_matches_1:wc_composite_admin_params.i18n_matches_n.replace("%qty%",a)},formatNoMatches:function(){return wc_composite_admin_params.i18n_no_matches},formatAjaxError:function(){return wc_composite_admin_params.i18n_ajax_error},formatInputTooShort:function(a,b){var c=b-a.length;return 1===c?wc_composite_admin_params.i18n_input_too_short_1:wc_composite_admin_params.i18n_input_too_short_n.replace("%qty%",c)},formatInputTooLong:function(a,b){var c=a.length-b;return 1===c?wc_composite_admin_params.i18n_input_too_long_1:wc_composite_admin_params.i18n_input_too_long_n.replace("%qty%",c)},formatSelectionTooBig:function(a){return 1===a?wc_composite_admin_params.i18n_selection_too_long_1:wc_composite_admin_params.i18n_selection_too_long_n.replace("%qty%",a)},formatLoadMore:function(){return wc_composite_admin_params.i18n_load_more},formatSearching:function(){return wc_composite_admin_params.i18n_searching}};a.fn.wc_cp_select2=function(){a(document.body).trigger("wc-enhanced-select-init")},a.fn.wc_cp_select2_component_options=function(){"yes"===wc_composite_admin_params.is_wc_version_gte_2_7?a(":input.wc-component-options-search",this).filter(":not(.enhanced)").each(function(){var b=a(this).data("action"),c=a(this),d={allowClear:!!a(this).data("allow_clear"),placeholder:a(this).data("placeholder"),minimumInputLength:a(this).data("minimum_input_length")?a(this).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(c){return{term:c.term,action:b,security:wc_enhanced_select_params.search_products_nonce,exclude:a(this).data("exclude"),include:a(this).data("include"),limit:a(this).data("limit")}},processResults:function(b){var d=[];return"yes"===c.data("component_optional")&&0===c.find('option[value="-1"]').length&&d.push({id:"-1",text:wc_composite_admin_params.i18n_none}),0===c.find('option[value="0"]').length&&d.push({id:"0",text:wc_composite_admin_params.i18n_all}),b&&a.each(b,function(a,b){d.push({id:a,text:b})}),{results:d}},cache:!0}};d=a.extend(d,n),a(this).select2(d).addClass("enhanced")}):a(this).find(":input.wc-component-options-search").filter(":not(.enhanced)").each(function(){var b=a(this).data("action"),c=a(this),d={allowClear:!!a(this).data("allow_clear"),placeholder:a(this).data("placeholder"),minimumInputLength:a(this).data("minimum_input_length")?a(this).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(c){return{term:c,action:b,security:woocommerce_admin_meta_boxes.search_products_nonce,exclude:a(this).data("exclude"),include:a(this).data("include"),limit:a(this).data("limit")}},results:function(b){var d=[];return"yes"===c.data("component_optional")&&0===c.find('option[value="-1"]').length&&d.push({id:"-1",text:wc_composite_admin_params.i18n_none}),0===c.find('option[value="0"]').length&&d.push({id:"0",text:wc_composite_admin_params.i18n_all}),b&&a.each(b,function(a,b){d.push({id:a,text:b})}),{results:d}},cache:!0}};a(this).data("multiple")===!0?(d.multiple=!0,d.initSelection=function(b,c){var d=a.parseJSON(b.attr("data-selected")),e=[];return a(b.val().split(",")).each(function(a,b){e.push({id:b,text:d[b]})}),c(e)},d.formatSelection=function(a){return'<div class="selected-option" data-id="'+a.id+'">'+a.text+"</div>"}):(d.multiple=!1,d.initSelection=function(a,b){var c={id:a.val(),text:a.attr("data-selected")};return b(c)}),d=a.extend(d,o),a(this).select2(d).addClass("enhanced")})};var p=a("#bto_product_data"),q=p.find(".bulk_toggle_wrapper"),r=a(".config_group",p),s=a(".bto_groups",r),t=a(".bto_group",s),u=t.length,v={},w=a("#bto_scenario_data"),x=w.find(".bulk_toggle_wrapper"),y=a(".bto_scenarios",w),z=a(".bto_scenario",y),A=z.length,B={},C={image_frame:!1,$button:!1},D={message:null,overlayCSS:{background:"#fff",opacity:.6}};a(".composite_stock_msg").appendTo("._manage_stock_field .description"),a("#_sold_individually").closest(".form-field").addClass("hide_if_composite"),a("#linked_product_data .grouping.show_if_simple, #linked_product_data .form-field.show_if_grouped").addClass("hide_if_composite"),a(".show_if_simple:not(.hide_if_composite)").addClass("show_if_composite"),"undefined"==typeof woocommerce_admin_meta_boxes&&(woocommerce_admin_meta_boxes=woocommerce_writepanel_params),a("body").on("woocommerce-product-type-change",function(b,c){"composite"===c&&(a(".show_if_external").hide(),a(".show_if_composite").show(),a("input#_manage_stock").change(),"no"===wc_composite_admin_params.is_wc_version_gte_2_7&&(a("#_regular_price").val(a("#_wc_cp_base_regular_price").val()).change(),a("#_sale_price").val(a("#_wc_cp_base_sale_price").val()).change()))}),a("select#product-type").change(),a("input#_downloadable").change(function(){a("select#product-type").change()}),a(".bundle_group .bto_layouts",p).on("click",".bto_layout_label",function(){a(this).closest(".bto_layouts").find(".selected").removeClass("selected"),a(this).addClass("selected")}),p.on("wc-cp-components-changed",function(){s=a(".bto_groups",r),t=a(".bto_group",s),t.each(function(b,c){a(".group_position",c).val(b),a(c).attr("rel",b)}),c()}),w.on("wc-cp-scenarios-changed",function(){y=a(".bto_scenarios",w),z=a(".bto_scenario",y),z.each(function(b,c){a(".scenario_position",c).val(b),a(c).attr("rel",b)}),i()}),g(),m(),a(".save_composition").on("click",function(){p.block(D),w.block(D),t.find("*").off();var b={post_id:woocommerce_admin_meta_boxes.post_id,data:a("#bto_product_data, #bto_scenario_data").find("input, select, textarea").serialize(),action:"woocommerce_bto_composite_save",security:wc_composite_admin_params.save_composite_nonce};setTimeout(function(){a.post(woocommerce_admin_meta_boxes.ajax_url,b,function(b){var c=window.location.toString();c=c.replace("post-new.php?","post.php?post="+woocommerce_admin_meta_boxes.post_id+"&action=edit&"),a.get(c,function(c){var d=[],g=[],h=a("#bto_config_group_inner",p),i=a("#bto_scenarios_inner",w),j=a(c).find("#bto_config_group_inner"),m=j.find(".bto_group"),n=a(c).find("#bto_scenarios_inner"),o=n.find(".bto_scenario");t.length===m.length&&t.each(function(){var b=a(this);if(b.hasClass("open")){var c=b.attr("rel");d.push(c)}}),m.each(function(){var b=a(this),c=b.attr("rel");a.inArray(c,d)!==-1?(b.addClass("open").removeClass("closed"),b.find(".wc-metabox-content").show()):b.find(".wc-metabox-content").hide()}),z.length===o.length&&i.find(".bto_scenario").each(function(){var b=a(this);if(b.hasClass("open")){var c=b.attr("rel");g.push(c)}}),o.each(function(){var b=a(this),c=b.attr("rel");a.inArray(c,g)!==-1?(b.addClass("open").removeClass("closed"),b.find(".wc-metabox-content").show()):b.find(".wc-metabox-content").hide()}),t.find("*").off(),z.find("*").off(),h.html(j.html()),i.html(n.html()),q=h.find(".bulk_toggle_wrapper"),x=i.find(".bulk_toggle_wrapper"),p.triggerHandler("wc-cp-components-changed"),f(),e(),w.triggerHandler("wc-cp-scenarios-changed"),l(),k(),a("#bto_product_data .woocommerce-help-tip, #bto_scenario_data .woocommerce-help-tip, #bto_scenario_data .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),h.wc_cp_select2(),i.wc_cp_select2(),h.wc_cp_select2_component_options(),i.wc_cp_select2_component_options(),b.length>0&&a.each(b,function(a,b){window.alert(b)}),p.unblock(),w.unblock()})},"json")},250)})});